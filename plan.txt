# üìö Story Booker - Development Plan

## ‚úÖ Current Status (v0.2.0)

### Completed Features
- ‚úÖ **API Foundation**: FastAPI backend with job-based async processing
- ‚úÖ **Story Generation**: Multi-provider LLM support (Groq, OpenAI, GPT4All)
- ‚úÖ **Image Generation**: Pollinations.ai and OpenAI DALL-E integration
- ‚úÖ **Character Consistency**: Character extraction, reference images, and visual DNA locking
- ‚úÖ **Art Style Templates**: CLAYMATION, VINTAGE_SKETCH, FLAT_DESIGN, 3D_RENDERED, WATERCOLOR, LINE_ART
- ‚úÖ **Cover & Back Cover**: Full-bleed cover with title, back cover with synopsis
- ‚úÖ **Multi-Language Support**: English and Spanish story generation
- ‚úÖ **Full-Page Illustrations**: Complete scene illustrations per page
- ‚úÖ **PDF Generation**: Professional layout with text overlay
- ‚úÖ **Progress Tracking**: Real-time job status and progress monitoring
- ‚úÖ **POD-Ready Mode**: CMYK conversion and print bleeds (partially implemented)

---

## üéØ Strategic Direction

### Primary Focus: **Web Frontend** ‚Üí **Local Providers (Optional)** ‚Üí **Shared Worlds** (Future)

**Phase 1 (Now)**: Build **web frontend application** that uses existing FastAPI backend
- Modern web UI for storybook creation
- Real-time progress tracking
- PDF preview and download
- Keep using APIs for now (Groq for stories, Pollinations/DALL-E for images)
- Configuration presets for repeatable workflows
- POD-ready output for commercial publishing

**Phase 2 (Later)**: Add **optional local providers** for privacy/offline use
- Stable Diffusion integration for local image generation
- GPT4All option for local story generation (keep API as default since it's almost free)
- Provider selection in UI (API vs Local)
- Fallback system (API ‚Üí Local if available)

**Phase 3 (Much Later)**: **Anthologies & Shared Worlds**
- Character libraries across books
- Shared environments/universes
- Cross-story consistency
- World-building tools

---

## üî¥ Phase 1: Web Frontend Application (Next 4-8 weeks)

**Goal**: Create a professional web application with beautiful UI for generating commercial-grade storybooks

### Current Provider Strategy (Phase 1)
- **Stories**: Use API providers (Groq - fast and free, OpenAI - premium)
- **Images**: Use API providers (Pollinations.ai - default, DALL-E - premium)
- **Reasoning**: APIs are fast, reliable, and cost-effective (Groq is nearly free)

### 1. Web Frontend UI üåê
**Priority: HIGH**
- **Frontend Framework**: React/Next.js or Vue.js/Nuxt.js (recommend Next.js for SSR)
- **UI Components**: Modern component library (Shadcn/ui, Tailwind UI, or Material-UI)
- **Theme Input**: Rich text editor or simple textarea for story theme
- **Parameter Selectors**: 
  - Dropdown for art style (CLAYMATION, VINTAGE_SKETCH, etc.)
  - Number of pages slider (1-10)
  - Language selector (multi-select: English, Spanish)
  - POD-ready toggle
  - Trim size selector (Square, Standard, Landscape)
- **Real-time Progress**: Live progress bars with step-by-step status
- **PDF Preview**: In-browser PDF viewer (PDF.js)
- **Download Interface**: Easy PDF download with organized file naming
- **File**: `frontend/` directory (separate or monorepo structure)

**Example UI Flow:**
1. User enters theme: "A brave mouse adventure"
2. Selects: Style=CLAYMATION, Pages=5, POD-ready=true
3. Clicks "Generate Storybook"
4. Shows progress: "Generating story... 15%" with real-time updates
5. When complete: Shows PDF preview + download button

### 2. Backend API Enhancements üîå
**Priority: HIGH**
- **WebSocket Support**: Real-time progress updates (optional, can use polling)
- **CORS Configuration**: Proper CORS setup for frontend domain
- **API Response Format**: Standardized JSON responses
- **Error Handling**: User-friendly error messages
- **File**: Update `src/main.py`, add WebSocket endpoint if needed

**Endpoints to Add/Enhance:**
- `POST /api/generate` - Already exists, ensure good error handling
- `GET /api/status/{job_id}` - Already exists, optimize for polling
- `GET /api/download/{job_id}` - Already exists
- `WS /api/status/{job_id}/stream` - (Optional) WebSocket for real-time updates

### 3. Complete POD Preflight System üñ®Ô∏è
**Priority: HIGH** (Partially implemented, needs completion)
- **CMYK Conversion**: Full RGB‚ÜíCMYK conversion for all images
- **Print Bleeds**: Ensure 0.125" bleeds on all pages (currently implemented)
- **KDP Validation**: Pre-upload validation checks (page count, dimensions, margins)
- **Color Profile Embedding**: Embed ICC profiles for accurate printing
- **Validation Report**: Generate KDP validation report (JSON/HTML)
- **File**: `services/pod_preflight.py` (enhance existing)

**Features:**
- Validate PDF meets KDP requirements before export
- Generate KDP validation report (shown in UI)
- Support multiple trim sizes (square 8.5x8.5, standard 8.5x11, etc.)
- Display validation results in frontend

### 4. Configuration Presets System üìã
**Priority: MEDIUM**
- **Preset Storage**: Backend stores presets (database or JSON files)
- **Preset API Endpoints**: 
  - `GET /api/presets` - List available presets
  - `POST /api/presets` - Create new preset
  - `PUT /api/presets/{id}` - Update preset
  - `DELETE /api/presets/{id}` - Delete preset
- **Built-in Presets**: KDP Square, KDP Standard, Print-Ready, Digital-Only
- **UI Preset Manager**: Frontend UI for creating/editing presets
- **Preset Application**: One-click preset application in generation form
- **File**: `services/preset_manager.py`, `src/main.py` (preset endpoints)

**Example Preset:**
```json
{
  "name": "KDP Square Children's",
  "trim_size": "8.5x8.5",
  "pod_ready": true,
  "style": "CLAYMATION",
  "writing_style": "whimsical",
  "min_pages": 24,
  "max_pages": 32,
  "languages": ["en"]
}
```

### 5. Writing Style Manager ‚úçÔ∏è
**Priority: MEDIUM**
- **Style Templates**: Dr. Seuss, Educational, Whimsical, Classic, Modern
- **System Prompt Injection**: Style-specific prompts for author agent
- **UI Selector**: Dropdown in frontend for writing style
- **API Parameter**: Add `writing_style` parameter to `/api/generate`
- **File**: `services/writing_styles.py`, update `author_agent.py`, update `src/main.py`

**Styles to Implement:**
- `whimsical`: Playful, rhyming, fun
- `educational`: Factual, informative, age-appropriate
- `classic`: Traditional fairy tale style
- `seuss`: Dr. Seuss-inspired rhyming
- `modern`: Contemporary, relatable

### 6. Trim Size & Layout Options üìê
**Priority: MEDIUM**
- **Multiple Trim Sizes**: Square (8.5√ó8.5"), Standard (8.5√ó11"), Landscape (11√ó8.5"), Custom
- **UI Selector**: Dropdown with visual preview or dimensions
- **Dynamic Layouts**: Auto-adjust text/image placement per trim size
- **API Parameter**: Add `trim_size` parameter to `/api/generate`
- **File**: Update `services/pdf_generator.py`, update `src/main.py`

### 7. Quality Control & Reporting üìä
**Priority: MEDIUM**
- **Generation Report**: JSON report per book (character count, word count, pages, images)
- **Quality Checks**: Validate story coherence, image quality, character consistency
- **UI Display**: Show quality report in frontend after generation
- **Export Options**: Download report as JSON/HTML
- **File**: `services/quality_report.py`, frontend report component

### 8. Job History & Management üíæ
**Priority: LOW** (Can be simple for now, full DB later)
- **In-Memory Job History**: Keep job list in memory (or simple JSON file)
- **Job Listing**: `GET /api/jobs` - List recent jobs
- **Job Details**: `GET /api/jobs/{job_id}` - Full job details
- **Job Cleanup**: Old job cleanup (older than X days)
- **UI Job History**: Simple list of past generations in frontend
- **File**: Update `src/main.py`, frontend history component

---

## üü° Phase 2: Optional Local Providers (Future)

**Goal**: Add local provider support for privacy-sensitive or offline workflows

### Provider Strategy (Phase 2)
- **Stories**: Keep API as default (Groq is nearly free), add GPT4All as optional local option
- **Images**: Add Stable Diffusion as local option, keep Pollinations/DALL-E as default
- **UI Toggle**: Provider selection in frontend (API vs Local)

### 1. Stable Diffusion Integration üé®
**Priority: MEDIUM** (When local needed)
- **Local SD Installation**: Support for local Stable Diffusion (A1111, ComfyUI, or direct)
- **SD API Client**: Interface with local SD instance
- **Model Support**: Support for common SD models (SDXL, etc.)
- **Seed Management**: Use same seed system for character consistency
- **Provider Selection**: UI toggle between API and Local for images
- **File**: `services/image_service.py` (add SD provider), `services/sd_client.py`

### 2. GPT4All Integration (Optional) üìö
**Priority: LOW** (API is almost free, so this is optional)
- **Local Model Loading**: Support GPT4All models
- **Model Selection**: UI for selecting local model
- **Provider Selection**: UI toggle between API (default) and Local for stories
- **File**: `services/llm_client.py` (already has GPT4All support, just needs UI)

### 3. Provider Selection UI üîÑ
**Priority: MEDIUM**
- **Provider Toggle**: Radio buttons or dropdowns for each service
  - Story Generation: Groq (API - Recommended) | OpenAI (API) | GPT4All (Local)
  - Image Generation: Pollinations (API - Recommended) | DALL-E (API) | Stable Diffusion (Local)
- **Provider Status**: Show if local providers are available/configured
- **Fallback Logic**: Auto-fallback if local provider fails

---

## üü¢ Phase 3: Anthologies & Shared Worlds (Much Later)

**Goal**: Enable multi-book series with shared characters and environments

### 1. Character Library System
- Save characters to reusable library
- Reference characters across multiple books
- Character evolution/aging tracking
- Visual consistency across series
- Character browser in frontend

### 2. Environment/World Builder
- Define shared settings/locations
- Consistent art style per world
- World rules and constraints
- Environment reference images
- World management UI

### 3. Anthology Generator
- Multiple stories in one book
- Shared universe consistency
- Series numbering and metadata
- Table of contents generation

### 4. Cross-Story Features
- Character appearance tracking
- Story continuity checker
- Timeline management
- Series overview dashboard

---

## üìù Technical Implementation Notes

### Current Architecture
- **Backend**: FastAPI (async) - Continue using, enhance for frontend
- **LLM**: Multi-provider (Groq, OpenAI, GPT4All) - Keep API as default
- **Images**: Pollinations.ai (default), OpenAI DALL-E (premium), Stable Diffusion (future local)
- **PDF**: FPDF2 (consider upgrading to ReportLab for better POD support)
- **Storage**: Local file system (assets/, output/) - Can migrate to cloud later

### Frontend Stack Options

**Option A: Next.js (Recommended)**
- React with SSR/SSG
- Great for SEO and performance
- Easy API integration
- Modern tooling (TypeScript, Tailwind CSS)

**Option B: Vue.js/Nuxt.js**
- Simpler learning curve
- Great reactivity
- Good ecosystem

**Option C: React SPA**
- Simple Create React App or Vite
- Fast development
- No SSR complexity

### Key Services to Enhance/Add

**Phase 1 (Frontend):**
- `frontend/` - Frontend application directory
- `services/pod_preflight.py` - Complete POD validation
- `services/preset_manager.py` - Configuration preset handling
- `services/writing_styles.py` - Writing style templates
- `services/quality_report.py` - Quality control and reporting
- `src/main.py` - Add preset endpoints, enhance error handling

**Phase 2 (Local Providers - Future):**
- `services/sd_client.py` - Stable Diffusion client
- Update `services/image_service.py` - Add SD provider
- Update `services/llm_client.py` - Enhanced GPT4All support

### Frontend Structure (Next.js Example)
```
frontend/
‚îú‚îÄ‚îÄ app/                          # Next.js app directory
‚îÇ   ‚îú‚îÄ‚îÄ page.tsx                  # Home page (generation form)
‚îÇ   ‚îú‚îÄ‚îÄ jobs/[id]/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx             # Job status page
‚îÇ   ‚îî‚îÄ‚îÄ api/                     # API routes (if needed)
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ GenerationForm.tsx       # Main generation form
‚îÇ   ‚îú‚îÄ‚îÄ ProgressTracker.tsx      # Progress display
‚îÇ   ‚îú‚îÄ‚îÄ PDFPreview.tsx           # PDF viewer
‚îÇ   ‚îú‚îÄ‚îÄ PresetManager.tsx        # Preset UI
‚îÇ   ‚îî‚îÄ‚îÄ JobHistory.tsx           # Job history list
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îú‚îÄ‚îÄ api.ts                   # API client functions
‚îÇ   ‚îî‚îÄ‚îÄ types.ts                 # TypeScript types
‚îú‚îÄ‚îÄ styles/
‚îÇ   ‚îî‚îÄ‚îÄ globals.css              # Global styles
‚îî‚îÄ‚îÄ package.json
```

### Dependencies to Add

**Frontend:**
- `next` or `react` + `vite` or `vue` + `nuxt`
- `axios` or `fetch` for API calls
- `pdfjs-dist` for PDF preview
- `tailwindcss` or similar for styling
- `shadcn/ui` or `@headlessui/react` for components

**Backend:**
- `python-socketio` (optional) - For WebSocket support
- `pyyaml` - For preset file parsing (if using YAML)
- `reportlab` (optional) - Enhanced PDF generation for POD

---

## üöÄ Immediate Next Steps (Week 1-2)

1. **Set Up Frontend Project** (Priority 1)
   - Initialize Next.js (or chosen framework) project
   - Set up project structure
   - Configure API client for FastAPI backend
   - Create basic generation form component

2. **Build Generation Form UI** (Priority 2)
   - Theme input field
   - Parameter selectors (pages, style, language, POD-ready)
   - Submit button with loading state
   - Basic error handling display

3. **Implement Progress Tracking** (Priority 3)
   - Poll `/api/status/{job_id}` endpoint
   - Display progress bar with steps
   - Show current step message
   - Handle completion and errors

4. **Complete POD Preflight** (Priority 4)
   - Verify CMYK conversion works correctly
   - Test bleeds on all pages
   - Add KDP validation checks
   - Display validation results in UI

---

## üìå Quick Reference

### Current API Endpoints
- `POST /generate` - Create storybook job
- `GET /status/{job_id}` - Check job status
- `GET /download/{job_id}` - Download PDF

### Current Parameters
- `theme`: Story theme (optional)
- `num_pages`: Number of pages (1-10, default: 5)
- `style`: Art style (CLAYMATION, VINTAGE_SKETCH, etc.)
- `languages`: List of languages (["en"], ["es"], ["en", "es"])
- `pod_ready`: Enable POD preflight (CMYK, bleeds) ‚úÖ

### Planned API Endpoints (Phase 1)
- `GET /api/presets` - List available presets
- `POST /api/presets` - Create new preset
- `PUT /api/presets/{id}` - Update preset
- `DELETE /api/presets/{id}` - Delete preset
- `GET /api/jobs` - List recent jobs
- `GET /api/jobs/{job_id}` - Get job details
- `WS /api/status/{job_id}/stream` - (Optional) WebSocket for real-time updates

### Planned Parameters (Phase 1)
- `writing_style`: Story writing style (whimsical, educational, etc.)
- `trim_size`: Book dimensions (square, standard, custom)
- `preset_id`: Use configuration preset

### Provider Strategy Summary

**Phase 1 (Now):**
- Stories: **Groq API** (fast, free) - Primary
- Stories: **OpenAI API** (premium) - Fallback
- Images: **Pollinations.ai API** (default)
- Images: **DALL-E API** (premium option)

**Phase 2 (Later - Optional):**
- Stories: Keep API as default, add **GPT4All (local)** as option
- Images: Keep API as default, add **Stable Diffusion (local)** as option
- UI allows switching between API and Local providers

---

## üéØ Success Metrics for Phase 1

### Web Frontend Readiness
- ‚úÖ Beautiful, intuitive UI for storybook generation
- ‚úÖ Real-time progress tracking with clear status messages
- ‚úÖ PDF preview in browser
- ‚úÖ Easy download functionality
- ‚úÖ Preset system for repeatable configurations
- ‚úÖ Mobile-responsive design

### Commercial Viability
- ‚úÖ PDFs ready for Amazon KDP upload
- ‚úÖ POD validation reports shown in UI
- ‚úÖ Multiple trim sizes supported
- ‚úÖ Professional quality reports
- ‚úÖ User-friendly experience

---

*Last Updated: v0.4.0 - Revised for Web Frontend focus with API providers*